<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ™®é€šå£çº¸ç”Ÿæˆå™¨ï¼ˆLiquid Glassï¼‰</title>

  <!-- React (UMD) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600;700&display=swap');
    body { font-family: 'Noto Sans SC', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background-color: #f3f4f6; }

    /* é¢„è§ˆåŒºåŸŸé€æ˜æ£‹ç›˜ */
    .preview-container {
      background-image:
        linear-gradient(45deg, #d1d5db 25%, transparent 25%),
        linear-gradient(-45deg, #d1d5db 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, #d1d5db 75%),
        linear-gradient(-45deg, transparent 75%, #d1d5db 75%);
      background-size: 20px 20px;
      background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
    }

    input[type="range"] { accent-color: auto; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useRef, useState } = React;

    // é»˜è®¤åº•éƒ¨å†…å®¹ï¼ˆé¢„ç½® 2 æ ï¼‰
    const defaultBottomContents = [
      "å¸¸ç”¨å¿«æ·é”®ï¼š \nå¤åˆ¶ï¼š Ctrl + C\nç²˜è´´ï¼š Ctrl + V\nå‰ªåˆ‡ï¼š Ctrl + X\nå…¨é€‰ï¼š Ctrl + A\næ‰“å¼€å‰ªåˆ‡ç‰ˆï¼š Win + V\næˆªå›¾ï¼š Win + Shift + S\næ ‡ç­¾ï¼š Win + ã€‚",
      "ä½¿ç”¨ç”µè„‘æé†’ï¼š \nè¿œç¦»æœç‹—/360\nç›´æ¥è®¿é—®è±†åŒ…xxè½¯ä»¶çš„å®˜ç½‘\nä½¿ç”¨å¿…åº”/è±†åŒ…æœç´¢å¼•æ“ï¼Œä¸ç”¨æœç‹—/360/ç™¾åº¦"
    ];

    // é»˜è®¤åˆ†ç±»åç§°
    const defaultCategories = [
      "ç³»ç»Ÿå·¥å…·",
      "åŠå…¬æ–‡å…·",
      "æ²Ÿé€šç¤¾äº¤",
      "å­¦ä¹ çŸ¥è¯†"
    ];

    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

    const ensureLen = (arr, len, fillFn) => {
      const next = Array.isArray(arr) ? [...arr] : [];
      while (next.length < len) next.push(fillFn(next.length));
      next.length = len;
      return next;
    };

    // è®¡ç®—â€œæŒ‰åˆ†æ•°å®½åº¦â€çš„ä¸€è¡Œå¸ƒå±€ï¼šæ¯æ ¼å®½åº¦ = W / denom
    // - denom èŒƒå›´ï¼š1~8ï¼ˆä»£è¡¨ 1/1 ~ 1/8ï¼‰
    // - è‹¥æ€»å®½è¶…å‡ºç”»å¸ƒï¼Œåˆ™æŒ‰æ¯”ä¾‹æ•´ä½“ç¼©æ”¾åˆ°åˆšå¥½å¡ä¸‹
    const computeRow = (count, denomArr, totalW) => {
      const denoms = ensureLen(denomArr, count, () => Math.max(1, Math.min(8, count)));
      const rawWs = denoms.map(d => totalW / clamp(parseInt(d, 10) || 1, 1, 8));
      const rawSum = rawWs.reduce((a, b) => a + b, 0);
      const scale = rawSum > totalW ? (totalW / rawSum) : 1;
      const ws = rawWs.map(w => w * scale);
      const sumW = ws.reduce((a, b) => a + b, 0);
      // é»˜è®¤å·¦å¯¹é½ï¼šå‰©ä½™ç©ºé—´ç•™åœ¨å³ä¾§ï¼ˆæ›´åƒæ¡Œé¢å›¾æ ‡/åˆ†åŒºçš„æ’å¸ƒæ–¹å¼ï¼‰
      const startX = 0;
      const items = [];
      let x = startX;
      for (let i = 0; i < count; i++) {
        items.push({ x, w: ws[i], denom: denoms[i] });
        x += ws[i];
      }
      return { items, scale, rawSum, sumW };
    };

    const widthOptions = [1,2,3,4,5,6,7,8];
    const fmtFrac = (d) => d === 1 ? "1/1ï¼ˆå…¨å®½ï¼‰" : `1/${d}`;


    // ç»ç’ƒæ»¤é•œï¼ˆé¡¶/åº•åŒæ„ï¼‰ï¼šä»…å‚æ•°æºä¸åŒ
    const GLASS_GAMMA = 0.96;

    const GlassDefs = ({
      prefix,
      blur,
      saturate,
      shadowOpacity,
      liquidFrequency,
      liquidScale,
      liquidSeed,
      specularSurfaceScale,
      specularExponent,
    }) => (
      <>
        {/* é˜´å½± */}
        <filter id={`${prefix}-shadow`} x="-40%" y="-40%" width="180%" height="180%">
          <feDropShadow dx="0" dy="18" stdDeviation="18" floodColor="#000" floodOpacity={shadowOpacity} />
          <feDropShadow dx="0" dy="4" stdDeviation="6" floodColor="#000" floodOpacity={shadowOpacity * 0.55} />
        </filter>

        {/* èƒŒæ™¯ç£¨ç ‚ï¼ˆåŸºç¡€ï¼‰ */}
        <filter id={`${prefix}-bg-basic`} x="-30%" y="-30%" width="160%" height="160%">
          <feGaussianBlur stdDeviation={blur} result="blurred" />
          <feColorMatrix in="blurred" type="saturate" values={saturate} result="sat" />
          <feComponentTransfer in="sat">
            <feFuncR type="gamma" amplitude="1" exponent={GLASS_GAMMA} offset="0" />
            <feFuncG type="gamma" amplitude="1" exponent={GLASS_GAMMA} offset="0" />
            <feFuncB type="gamma" amplitude="1" exponent={GLASS_GAMMA} offset="0" />
          </feComponentTransfer>
        </filter>

        {/* èƒŒæ™¯ç£¨ç ‚ + æŠ˜å°„ï¼ˆæ¶²æ€ï¼‰ */}
        <filter id={`${prefix}-bg-liquid`} x="-40%" y="-40%" width="180%" height="180%" colorInterpolationFilters="sRGB">
          <feTurbulence
            type="fractalNoise"
            baseFrequency={`${liquidFrequency} ${liquidFrequency}`}
            numOctaves="2"
            seed={liquidSeed}
            result="noise"
          />
          <feGaussianBlur in="noise" stdDeviation="2" result="softNoise" />
          <feDisplacementMap
            in="SourceGraphic"
            in2="softNoise"
            scale={liquidScale}
            xChannelSelector="R"
            yChannelSelector="G"
            result="displaced"
          />
          <feGaussianBlur in="displaced" stdDeviation={blur} result="blurred" />
          <feColorMatrix in="blurred" type="saturate" values={saturate} result="sat" />
          <feComponentTransfer in="sat">
            <feFuncR type="gamma" amplitude="1" exponent={GLASS_GAMMA} offset="0" />
            <feFuncG type="gamma" amplitude="1" exponent={GLASS_GAMMA} offset="0" />
            <feFuncB type="gamma" amplitude="1" exponent={GLASS_GAMMA} offset="0" />
          </feComponentTransfer>
        </filter>

        {/* é•œé¢é«˜å…‰ï¼ˆProï¼‰ */}
        <filter id={`${prefix}-specular`} x="-30%" y="-30%" width="160%" height="160%" colorInterpolationFilters="sRGB">
          <feGaussianBlur in="SourceAlpha" stdDeviation="3" result="alphaBlur" />
          <feSpecularLighting
            in="alphaBlur"
            surfaceScale={specularSurfaceScale}
            specularConstant="1"
            specularExponent={specularExponent}
            lightingColor="white"
            result="spec"
          >
            <fePointLight x="-200" y="-200" z="300" />
          </feSpecularLighting>
          <feComposite in="spec" in2="SourceAlpha" operator="in" result="specClipped" />
          <feComponentTransfer in="specClipped" result="specOut">
            <feFuncA type="table" tableValues="0 0.9" />
          </feComponentTransfer>
          <feMerge>
            <feMergeNode in="specOut" />
          </feMerge>
        </filter>
      </>
    );
    const App = () => {
      const [config, setConfig] = useState({
        width: 1920,
        height: 1080,

        // èƒŒæ™¯å±‚
        bgColor: "#EDF1F4",
        bgOpacity: 1,
        bgImage: null,
        // å›¾ç‰‡é€æ˜åº¦é»˜è®¤ 100%
        bgImageOpacity: 1,

        // ä»»åŠ¡æ é¢„ç•™
        taskbarHeight: 60,

        // ä¸Šéƒ¨åˆ†ç±»
        categoryCount: 4,
        categories: defaultCategories,
        categoryWidthDivs: Array(4).fill(5),

        // ä¸‹éƒ¨æç¤º
        bottomCount: 2,
        bottomContents: defaultBottomContents,
        bottomWidthDivs: [5, 3],

        // å…¨å±€
        fontSizeMode: "large", // normal, large, extra

        // âœ… åˆ†ç±»å±‚é£æ ¼
        categoryStyle: "liquidPro", // glass | liquid | liquidPro | classic

        // âœ… é¡¶éƒ¨ç»ç’ƒå‚æ•°ï¼ˆå¯è°ƒï¼‰
        glassBlur: 2,
        glassSaturate: 1.6,
        glassTintOpacity: 0.05,
        glassHighlightOpacity: 0.10,
        glassStrokeOpacity: 0.26,
        glassShadowOpacity: 0.20,

        liquidFrequency: 0.008,
        liquidScale: 20,
        liquidSeed: 92,

        specularOpacity: 0.26,
        specularSurfaceScale: 5,
        specularExponent: 100,

        // âœ… åˆ†ç±»æ ‡ç­¾å­—é‡ï¼ˆä½ æƒ³æ‰‹åŠ¨è¯•è¯•ï¼šæ­¥è¿› 50ï¼‰
        labelFontWeight: 500,

        // âœ… åº•éƒ¨å°è´´å£«ï¼šå•ç‹¬ä¸€å¥—ç»ç’ƒé…ç½®ï¼ˆä¸é¡¶éƒ¨åˆ†ç¦»ï¼‰
        tipsStyle: "liquidPro", // glass | liquid | liquidPro | classic

        tipsBlur: 6,
        tipsSaturate: 1.35,
        tipsTintColor: "#000000",
        tipsTintOpacity: 0.20,
        tipsHighlightOpacity: 0.60,
        tipsStrokeOpacity: 0.45,
        tipsShadowOpacity: 0.22,

        tipsLiquidFrequency: 0.010,
        tipsLiquidScale: 40,
        tipsLiquidSeed: 222,

        tipsSpecularOpacity: 0.18,
        tipsSpecularSurfaceScale: 4,
        tipsSpecularExponent: 90,
      });

      const [zoom, setZoom] = useState(0.45);
      const [fullPreview, setFullPreview] = useState(false);
      const [fullPreviewUrl, setFullPreviewUrl] = useState(null);
      const svgRef = useRef(null);

      const buildSvgBlobUrl = () => {
        const svg = svgRef.current;
        if (!svg) return null;
        const clonedSvg = svg.cloneNode(true);
        clonedSvg.setAttribute("width", String(config.width));
        clonedSvg.setAttribute("height", String(config.height));
        clonedSvg.setAttribute("viewBox", `0 0 ${config.width} ${config.height}`);
        const data = new XMLSerializer().serializeToString(clonedSvg);
        const blob = new Blob([data], { type: "image/svg+xml;charset=utf-8" });
        return URL.createObjectURL(blob);
      };

      const openFullPreview = () => {
        const url = buildSvgBlobUrl();
        if (!url) return;
        setFullPreviewUrl(prev => {
          if (prev) URL.revokeObjectURL(prev);
          return url;
        });
        setFullPreview(true);
      };

      const closeFullPreview = () => {
        setFullPreview(false);
        setFullPreviewUrl(prev => {
          if (prev) URL.revokeObjectURL(prev);
          return null;
        });
      };

      // å…¨å±é¢„è§ˆï¼šEsc é€€å‡º + ç¦æ­¢èƒŒæ™¯æ»šåŠ¨
      useEffect(() => {
        if (!fullPreview) return;

        const onKeyDown = (e) => {
          if (e.key === "Escape") closeFullPreview();
        };

        window.addEventListener("keydown", onKeyDown);
        const prevOverflow = document.body.style.overflow;
        document.body.style.overflow = "hidden";

        return () => {
          window.removeEventListener("keydown", onKeyDown);
          document.body.style.overflow = prevOverflow;
        };
      }, [fullPreview]);

      // å›¾ç‰‡ä¸Šä¼ 
      const handleImageUpload = (e) => {
        const file = e.target.files?.[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => setConfig(prev => ({ ...prev, bgImage: event.target.result }));
        reader.readAsDataURL(file);
      };

      const setCategoryCount = (n) => {
        setConfig(prev => {
          const categories = ensureLen(prev.categories, n, (i) => `åˆ†ç±» ${i + 1}`);
          const widthDivs = ensureLen(prev.categoryWidthDivs, n, () => clamp(n, 1, 8));
          return { ...prev, categoryCount: n, categories, categoryWidthDivs: widthDivs };
        });
      };

      const setBottomCount = (n) => {
        setConfig(prev => {
          const bottomContents = ensureLen(prev.bottomContents, n, (i) => i === 0 ? defaultBottomContents[0] : "");
          const widthDivs = ensureLen(prev.bottomWidthDivs, n, () => clamp(n, 1, 8));
          return { ...prev, bottomCount: n, bottomContents, bottomWidthDivs: widthDivs };
        });
      };

      const updateCategoryName = (index, newName) => {
        setConfig(prev => {
          const next = [...prev.categories];
          next[index] = newName;
          return { ...prev, categories: next };
        });
      };

      const updateCategoryWidth = (index, denom) => {
        setConfig(prev => {
          const next = [...prev.categoryWidthDivs];
          next[index] = clamp(parseInt(denom, 10) || 1, 1, 8);
          return { ...prev, categoryWidthDivs: next };
        });
      };

      const updateBottomContent = (index, newContent) => {
        setConfig(prev => {
          const next = [...prev.bottomContents];
          next[index] = newContent;
          return { ...prev, bottomContents: next };
        });
      };

      const updateBottomWidth = (index, denom) => {
        setConfig(prev => {
          const next = [...prev.bottomWidthDivs];
          next[index] = clamp(parseInt(denom, 10) || 1, 1, 8);
          return { ...prev, bottomWidthDivs: next };
        });
      };

      // ä¸‹è½½ PNGï¼ˆSVG -> Canvasï¼‰
      const downloadPNG = () => {
        const svg = svgRef.current;
        if (!svg) return;
        const canvas = document.createElement("canvas");
        canvas.width = config.width;
        canvas.height = config.height;
        const ctx = canvas.getContext("2d");

        // å¯¼å‡ºæ—¶å†™æ­»åƒç´ å°ºå¯¸ï¼Œé¿å… 100% å¯¼è‡´ä½åˆ†è¾¨ç‡
        const clonedSvg = svg.cloneNode(true);
        clonedSvg.setAttribute("width", String(config.width));
        clonedSvg.setAttribute("height", String(config.height));
        clonedSvg.setAttribute("viewBox", `0 0 ${config.width} ${config.height}`);

        const data = new XMLSerializer().serializeToString(clonedSvg);
        const img = new Image();
        const svgBlob = new Blob([data], { type: "image/svg+xml;charset=utf-8" });
        const url = URL.createObjectURL(svgBlob);

        img.onload = () => {
          ctx.imageSmoothingEnabled = true;
          ctx.imageSmoothingQuality = "high";
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          URL.revokeObjectURL(url);

          canvas.toBlob((blob) => {
            if (!blob) return;
            const pngUrl = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.download = `wallpaper.png`;
            a.href = pngUrl;
            a.click();
            URL.revokeObjectURL(pngUrl);
          }, "image/png");
        };
        img.src = url;
      };

      // ä¸‹è½½ SVG
      const downloadSVG = () => {
        const svg = svgRef.current;
        if (!svg) return;

        const clonedSvg = svg.cloneNode(true);
        clonedSvg.setAttribute("width", String(config.width));
        clonedSvg.setAttribute("height", String(config.height));
        clonedSvg.setAttribute("viewBox", `0 0 ${config.width} ${config.height}`);

        const data = new XMLSerializer().serializeToString(clonedSvg);
        const blob = new Blob([data], { type: "image/svg+xml;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.download = `wallpaper.svg`;
        a.href = url;
        a.click();
      };

      // --- å¸ƒå±€ ---
      const layout = useMemo(() => {
        const usableHeight = config.height - config.taskbarHeight;
        const appAreaHeight = usableHeight * (2 / 3);
        const tipsAreaHeight = usableHeight * (1 / 3);

        const topRow = computeRow(config.categoryCount, config.categoryWidthDivs, config.width);
        const bottomRow = computeRow(config.bottomCount, config.bottomWidthDivs, config.width);

        const topBoxHeight = appAreaHeight;
        const bottomBoxHeight = tipsAreaHeight - 20;

        return { usableHeight, appAreaHeight, tipsAreaHeight, topRow, bottomRow, topBoxHeight, bottomBoxHeight };
      }, [
        config.width,
        config.height,
        config.taskbarHeight,
        config.categoryCount,
        config.bottomCount,
        JSON.stringify(config.categoryWidthDivs),
        JSON.stringify(config.bottomWidthDivs)
      ]);

      const { appAreaHeight, topRow, bottomRow, topBoxHeight, bottomBoxHeight } = layout;

      const labelFont =
        config.fontSizeMode === "extra" ? 34 :
        config.fontSizeMode === "large" ? 28 : 24;

      // é¡¶éƒ¨å¡ç‰‡æ¸²æŸ“
      const renderTopCard = (i) => {
        const item = topRow.items[i];
        const x = item.x;
        const w = item.w;
        const y = 0;

        // è®©â€œé«˜åº¦/åœ†è§’â€ä¸éšå®½åº¦å˜åŒ–ï¼šæ°´å¹³ padding å¯éšå®½åº¦å˜åŒ–ï¼Œå‚ç›´ padding å›ºå®šï¼ˆéšé«˜åº¦å˜åŒ–ï¼‰
        const padX = clamp(w * 0.06, 18, 28);
        const padY = clamp(topBoxHeight * 0.05, 18, 28);
        const labelAreaH = clamp(topBoxHeight * 0.12, 60, 96);

        const cardX = x + padX;
        const cardY = y + padY;
        const cardW = w - padX * 2;
        const cardH = topBoxHeight - padY * 2 - labelAreaH;

        // åœ†è§’ï¼šé»˜è®¤æŒ‰é«˜åº¦ç»™ä¸€ä¸ªç»Ÿä¸€å€¼ï¼Œå¹¶é˜²æ­¢è¶…è¿‡å¡ç‰‡å°ºå¯¸çš„ä¸€åŠ
        const baseRx = clamp(topBoxHeight * 0.075, 24, 36);
        const rx = Math.min(baseRx, cardW / 2, cardH / 2);

        const title = config.categories[i] || `åˆ†ç±» ${i + 1}`;
        const labelX = x + w / 2;
        const labelY = cardY + cardH + labelAreaH / 2 + 2;

        const clipId = `clip-top-${i}`;

        const bgFilter =
          config.categoryStyle === "glass" ? "glass-bg-basic" :
          (config.categoryStyle === "liquid" || config.categoryStyle === "liquidPro") ? "glass-bg-liquid" :
          null;

        if (config.categoryStyle === "classic") {
          return (
            <g key={`top-${i}`}>
              <rect
                x={cardX}
                y={cardY}
                width={cardW}
                height={cardH}
                rx={rx}
                fill="none"
                stroke="#ffffff"
                strokeWidth="2"
                opacity="0.35"
              />

              <text
                x={labelX}
                y={labelY}
                textAnchor="middle"
                dominantBaseline="middle"
                fontSize={labelFont}
                fontWeight={config.labelFontWeight}
                fill="#ffffff"
                filter="url(#label-shadow)"
                style={{ fontFamily: "Noto Sans SC, sans-serif" }}
              >
                {title}
              </text>
            </g>
          );
        }

        return (
          <g key={`top-${i}`}>
            <clipPath id={clipId}>
              <rect x={cardX} y={cardY} width={cardW} height={cardH} rx={rx} />
            </clipPath>

            {/* å¤–é˜´å½± */}
            <rect
              x={cardX}
              y={cardY}
              width={cardW}
              height={cardH}
              rx={rx}
              fill="#000"
              opacity="0.001"
              filter="url(#glass-shadow)"
            />

            <g clipPath={`url(#${clipId})`}>
              {/* èƒŒæ™¯å‰¯æœ¬ + æ¨¡ç³Š/æŠ˜å°„ */}
              <g filter={`url(#${bgFilter})`}>
                <use href="#wallpaper-bg" xlinkHref="#wallpaper-bg" />
              </g>

              {/* tint */}
              <rect
                x={cardX}
                y={cardY}
                width={cardW}
                height={cardH}
                rx={rx}
                fill="#ffffff"
                opacity={config.glassTintOpacity}
              />

              {/* highlight */}
              <rect
                x={cardX}
                y={cardY}
                width={cardW}
                height={cardH}
                rx={rx}
                fill="url(#glass-highlight)"
                opacity={config.glassHighlightOpacity}
              />

              {/* specular */}
              {config.categoryStyle === "liquidPro" && (
                <rect
                  x={cardX}
                  y={cardY}
                  width={cardW}
                  height={cardH}
                  rx={rx}
                  fill="#ffffff"
                  opacity={config.specularOpacity}
                  filter="url(#glass-specular)"
                />
              )}

              {/* stroke */}
              <rect
                x={cardX}
                y={cardY}
                width={cardW}
                height={cardH}
                rx={rx}
                fill="none"
                stroke="url(#glass-stroke)"
                strokeWidth="1.5"
                opacity={config.glassStrokeOpacity}
              />
            </g>

            {/* æ ‡ç­¾ï¼šå†™åœ¨ç»ç’ƒä¸‹æ–¹å±…ä¸­ */}
            <text
              x={labelX}
              y={labelY}
              textAnchor="middle"
              dominantBaseline="middle"
              fontSize={labelFont}
              fontWeight={config.labelFontWeight}
              fill="#ffffff"
              filter="url(#label-shadow)"
              style={{ fontFamily: "Noto Sans SC, sans-serif" }}
            >
              {title}
            </text>
          </g>
        );
      };

      // åº•éƒ¨å°è´´å£«å¡ç‰‡ï¼ˆç»ç’ƒï¼‰
      const renderBottomCell = (i) => {
        const item = bottomRow.items[i];
        const x = item.x;
        const w = item.w;
        const y = 20;

        // åŒä¸Šï¼šæ°´å¹³ padding å¯éšå®½åº¦å˜åŒ–ï¼Œå‚ç›´ padding å›ºå®šï¼ˆéšé«˜åº¦å˜åŒ–ï¼‰ï¼Œé¿å…ä¸åŒå®½åº¦æ—¶é«˜åº¦å‚å·®
        const padX = clamp(w * 0.06, 16, 26);
        const padY = clamp(bottomBoxHeight * 0.08, 16, 26);
        const cardX = x + padX;
        const cardY = y + padY;
        const cardW = w - padX * 2;
        const cardH = bottomBoxHeight - padY * 2;

        const baseRx = clamp(bottomBoxHeight * 0.18, 20, 32);
        const rx = Math.min(baseRx, cardW / 2, cardH / 2);

        const content = config.bottomContents[i] || "";
        // åŒæ—¶å…¼å®¹ï¼šçœŸå®æ¢è¡Œï¼ˆå›è½¦ï¼‰ä¸æ‰‹åŠ¨è¾“å…¥çš„ "\\n" è½¬ä¹‰ç¬¦
        const lines = String(content).split(/\r?\n|\\n/g);

        const clipId = `clip-bottom-${i}`;

        const bgFilter =
          config.tipsStyle === "glass" ? "tips-bg-basic" :
          (config.tipsStyle === "liquid" || config.tipsStyle === "liquidPro") ? "tips-bg-liquid" :
          null;

        // Classicï¼šå¯¹ç…§
        if (config.tipsStyle === "classic") {
          return (
            <g key={`bottom-${i}`}>
              <rect
                x={cardX}
                y={cardY}
                width={cardW}
                height={cardH}
                rx={rx}
                fill="none"
                stroke="#ffffff"
                strokeWidth="2"
                opacity="0.28"
              />
              <clipPath id={clipId}>
                <rect x={cardX} y={cardY} width={cardW} height={cardH} rx={rx} />
              </clipPath>
              <g clipPath={`url(#${clipId})`}>
                {lines.map((line, idx) => (
                  <text
                    key={idx}
                    x={cardX + clamp(cardW * 0.07, 22, 30)}
                    y={cardY + 46 + idx * 30}
                    fontSize="20"
                    fill="#ffffff"
                    fontWeight={idx === 0 ? "600" : "400"}
                    opacity={idx === 0 ? 0.96 : 0.85}
                    filter="url(#text-shadow)"
                    style={{ fontFamily: "Noto Sans SC, sans-serif" }}
                  >
                    {line}
                  </text>
                ))}
              </g>
            </g>
          );
        }

        return (
          <g key={`bottom-${i}`}>
            <clipPath id={clipId}>
              <rect x={cardX} y={cardY} width={cardW} height={cardH} rx={rx} />
            </clipPath>

            {/* å¤–é˜´å½± */}
            <rect
              x={cardX}
              y={cardY}
              width={cardW}
              height={cardH}
              rx={rx}
              fill="#000"
              opacity="0.001"
              filter="url(#tips-shadow)"
            />

            <g clipPath={`url(#${clipId})`}>
              {/* èƒŒæ™¯å‰¯æœ¬ + æ¨¡ç³Š/æŠ˜å°„ */}
              <g filter={`url(#${bgFilter})`}>
                {/*
                  å…³é”®ï¼šåº•éƒ¨æ•´å—åŒºåŸŸæœ‰ translate(0, appAreaHeight)ã€‚
                  å¦‚æœä¸æŠŠèƒŒæ™¯å‰¯æœ¬å‘ä¸ŠæŠµæ¶ˆ appAreaHeightï¼Œä¼šå¯¼è‡´â€œé‡‡æ ·é”™ä½â€ï¼Œä»è€Œæ— æ³•åšåˆ°å‚æ•°å½’é›¶æ—¶çš„å®Œå…¨é€æ˜ã€‚
                */}
                <use href="#wallpaper-bg" xlinkHref="#wallpaper-bg" y={-appAreaHeight} />
              </g>

              {/* tintï¼ˆå¯é€‰é¢œè‰²ï¼‰ */}
              <rect
                x={cardX}
                y={cardY}
                width={cardW}
                height={cardH}
                rx={rx}
                fill={config.tipsTintColor}
                opacity={config.tipsTintOpacity}
              />

              {/* highlight */}
              <rect
                x={cardX}
                y={cardY}
                width={cardW}
                height={cardH}
                rx={rx}
                fill="url(#glass-highlight)"
                opacity={config.tipsHighlightOpacity}
              />

              {/* specular */}
              {config.tipsStyle === "liquidPro" && (
                <rect
                  x={cardX}
                  y={cardY}
                  width={cardW}
                  height={cardH}
                  rx={rx}
                  fill="#ffffff"
                  opacity={config.tipsSpecularOpacity}
                  filter="url(#tips-specular)"
                />
              )}

              {/* stroke */}
              <rect
                x={cardX}
                y={cardY}
                width={cardW}
                height={cardH}
                rx={rx}
                fill="none"
                stroke="url(#glass-stroke)"
                strokeWidth="1.5"
                opacity={config.tipsStrokeOpacity}
              />

              {/* æ–‡æœ¬ï¼ˆç™½å­—é»‘é˜´å½±ï¼‰ */}
              {lines.map((line, idx) => (
                <text
                  key={idx}
                  x={cardX + clamp(cardW * 0.07, 22, 30)}
                  y={cardY + 46 + idx * 30}
                  fontSize="20"
                  fill="#ffffff"
                  fontWeight={idx === 0 ? "600" : "400"}
                  opacity={idx === 0 ? 0.96 : 0.85}
                  filter="url(#text-shadow)"
                  style={{ fontFamily: "Noto Sans SC, sans-serif" }}
                >
                  {line}
                </text>
              ))}
            </g>
          </g>
        );
      };

      // ç»Ÿä¸€ SVGï¼ˆç”¨äºå³ä¾§ç”»å¸ƒ + å…¨å±é¢„è§ˆï¼‰
      const WallpaperSVG = ({ attachRef = false }) => (
        <svg
          ref={attachRef ? svgRef : null}
          width="100%"
          height="100%"
          viewBox={`0 0 ${config.width} ${config.height}`}
          preserveAspectRatio="xMidYMid meet"
          xmlns="http://www.w3.org/2000/svg"
          xmlnsXlink="http://www.w3.org/1999/xlink"
        >
          <defs>
            {/* ç»ç’ƒæ»¤é•œï¼šé¡¶éƒ¨ä¸åº•éƒ¨åŒæ„ï¼ˆä»…å‚æ•°æºä¸åŒï¼‰ */}
            <GlassDefs
              prefix="glass"
              blur={config.glassBlur}
              saturate={config.glassSaturate}
              shadowOpacity={config.glassShadowOpacity}
              liquidFrequency={config.liquidFrequency}
              liquidScale={config.liquidScale}
              liquidSeed={config.liquidSeed}
              specularSurfaceScale={config.specularSurfaceScale}
              specularExponent={config.specularExponent}
            />
            <GlassDefs
              prefix="tips"
              blur={config.tipsBlur}
              saturate={config.tipsSaturate}
              shadowOpacity={config.tipsShadowOpacity}
              liquidFrequency={config.tipsLiquidFrequency}
              liquidScale={config.tipsLiquidScale}
              liquidSeed={config.tipsLiquidSeed}
              specularSurfaceScale={config.tipsSpecularSurfaceScale}
              specularExponent={config.tipsSpecularExponent}
            />

            {/* åˆ†ç±»åç§°é˜´å½±ï¼šç™½å­— + é»‘é˜´å½±ï¼ˆåƒæ¡Œé¢æ ‡ç­¾ï¼‰ */}
            <filter id="label-shadow" x="-50%" y="-50%" width="200%" height="200%">
              <feDropShadow dx="0" dy="2" stdDeviation="2.2" floodColor="#000" floodOpacity="0.85" />
              <feDropShadow dx="0" dy="0" stdDeviation="1.2" floodColor="#000" floodOpacity="0.45" />
            </filter>

            {/* å°è´´å£«æ–‡å­—é˜´å½±ï¼šç¨å¾®æ›´æŸ”ä¸€äº› */}
            <filter id="text-shadow" x="-50%" y="-50%" width="200%" height="200%">
              <feDropShadow dx="0" dy="2" stdDeviation="2.2" floodColor="#000" floodOpacity="0.78" />
              <feDropShadow dx="0" dy="0" stdDeviation="1.1" floodColor="#000" floodOpacity="0.40" />
            </filter>
{/* é«˜å…‰æ¸å˜ */}
            <radialGradient id="glass-highlight" cx="22%" cy="14%" r="85%">
              <stop offset="0%" stopColor="#ffffff" stopOpacity="0.62" />
              <stop offset="45%" stopColor="#ffffff" stopOpacity="0.14" />
              <stop offset="100%" stopColor="#ffffff" stopOpacity="0" />
            </radialGradient>

            {/* è¾¹ç¼˜æ¸å˜ */}
            <linearGradient id="glass-stroke" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stopColor="#ffffff" stopOpacity="0.55" />
              <stop offset="45%" stopColor="#ffffff" stopOpacity="0.18" />
              <stop offset="100%" stopColor="#000000" stopOpacity="0.14" />
            </linearGradient>
          </defs>

          {/* èƒŒæ™¯ç»„ï¼ˆä¾›ç»ç’ƒå¡ç‰‡ use å¤ç”¨ï¼‰ */}
          <g id="wallpaper-bg">
            <rect width="100%" height="100%" fill={config.bgColor} fillOpacity={config.bgOpacity} />
            {config.bgImage && (
              <image
                href={config.bgImage}
                xlinkHref={config.bgImage}
                width="100%"
                height="100%"
                preserveAspectRatio="xMidYMid slice"
                opacity={config.bgImageOpacity}
              />
            )}
          </g>

          {/* é¡¶éƒ¨ï¼šåº”ç”¨åˆ†ç±» */}
          <g transform="translate(0, 0)">
            {Array.from({ length: config.categoryCount }).map((_, i) => renderTopCard(i))}
          </g>

          {/* åº•éƒ¨ï¼šå°è´´å£« */}
          <g transform={`translate(0, ${appAreaHeight})`}>
{Array.from({ length: config.bottomCount }).map((_, i) => renderBottomCell(i))}
          </g>
        </svg>
      );

      return (
        <>
        <div className="flex flex-col h-screen md:flex-row overflow-hidden">
          {/* å·¦ä¾§æ§åˆ¶é¢æ¿ */}
          <div className="w-full md:w-1/3 lg:w-1/4 bg-white shadow-lg overflow-y-auto p-6 z-10 border-r border-gray-200">
            <div className="mb-6">
              <h1 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                <span className="inline-flex items-center justify-center w-6 h-6 rounded bg-gray-100">ğŸªŸ</span>
                æ™®é€šå£çº¸ç”Ÿæˆå™¨ï¼ˆV2ï¼‰
              </h1>
              <p className="text-sm text-gray-500 mt-1">é¡¶éƒ¨åˆ†ç±» + åº•éƒ¨å°è´´å£«ï¼šå‡ä¸º SVG Liquid Glassï¼ˆåº•éƒ¨å¯ç‹¬ç«‹è°ƒå‚ï¼‰</p>
            </div>

            <div className="space-y-6">
              {/* 1. ç”»å¸ƒä¸åº•å±‚ */}
              <div className="bg-gray-50 p-4 rounded-lg border border-gray-100">
                <h3 className="font-semibold text-gray-700 mb-3 flex items-center">
                  <span className="w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center mr-2 text-xs">1</span>
                  ç”»å¸ƒä¸åº•å±‚
                </h3>

                <div className="grid grid-cols-2 gap-2 mb-3">
                  <label className="text-xs text-gray-600">å®½åº¦ (px)
                    <input
                      type="number"
                      value={config.width}
                      onChange={e => setConfig(prev => ({ ...prev, width: parseInt(e.target.value || "0", 10) }))}
                      className="w-full mt-1 p-2 border rounded"
                    />
                  </label>
                  <label className="text-xs text-gray-600">é«˜åº¦ (px)
                    <input
                      type="number"
                      value={config.height}
                      onChange={e => setConfig(prev => ({ ...prev, height: parseInt(e.target.value || "0", 10) }))}
                      className="w-full mt-1 p-2 border rounded"
                    />
                  </label>
                </div>

                <div className="mb-3">
                  <label className="text-xs text-gray-600 block mb-1">èƒŒæ™¯é¢œè‰²</label>
                  <div className="flex gap-2 items-center">
                    <input
                      type="color"
                      value={config.bgColor}
                      onChange={e => setConfig(prev => ({ ...prev, bgColor: e.target.value }))}
                      className="h-8 w-16 cursor-pointer"
                    />
                    <input
                      type="range"
                      min="0"
                      max="1"
                      step="0.05"
                      value={config.bgOpacity}
                      onChange={e => setConfig(prev => ({ ...prev, bgOpacity: parseFloat(e.target.value) }))}
                      className="flex-1"
                    />
                    <span className="text-xs font-mono text-gray-500 w-12 text-right">{Math.round(config.bgOpacity * 100)}%</span>
                  </div>
                </div>

                <div>
                  <label className="text-xs text-gray-600 block mb-1">ä»»åŠ¡æ é¢„ç•™é«˜åº¦ (px)</label>
                  <input
                    type="number"
                    value={config.taskbarHeight}
                    onChange={e => setConfig(prev => ({ ...prev, taskbarHeight: parseInt(e.target.value || "0", 10) }))}
                    className="w-full p-2 border rounded"
                  />
                </div>
              </div>

              {/* 2. å›¾ç‰‡å±‚ */}
              <div className="bg-gray-50 p-4 rounded-lg border border-gray-100">
                <h3 className="font-semibold text-gray-700 mb-3 flex items-center">
                  <span className="w-6 h-6 rounded-full bg-green-100 text-green-600 flex items-center justify-center mr-2 text-xs">2</span>
                  è£…é¥°å›¾ç‰‡å±‚
                </h3>

                <div className="mb-3">
                  <label className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100 cursor-pointer">
                    é€‰æ‹©å›¾ç‰‡...
                    <input type="file" accept="image/*" onChange={handleImageUpload} className="hidden" />
                  </label>
                </div>

                {config.bgImage && (
                  <div>
                    <label className="text-xs text-gray-600 block mb-1">å›¾ç‰‡é€æ˜åº¦</label>
                    <div className="flex gap-2 items-center">
                      <input
                        type="range"
                        min="0"
                        max="1"
                        step="0.05"
                        value={config.bgImageOpacity}
                        onChange={e => setConfig(prev => ({ ...prev, bgImageOpacity: parseFloat(e.target.value) }))}
                        className="w-full"
                      />
                      <span className="text-xs font-mono text-gray-500 w-12 text-right">{Math.round(config.bgImageOpacity * 100)}%</span>
                    </div>
                  </div>
                )}
              </div>

              {/* 3. é¡¶éƒ¨åº”ç”¨åˆ†ç±» */}
              <div className="bg-gray-50 p-4 rounded-lg border border-gray-100">
                <h3 className="font-semibold text-gray-700 mb-3 flex items-center">
                  <span className="w-6 h-6 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center mr-2 text-xs">3</span>
                  é¡¶éƒ¨åº”ç”¨åˆ†ç±»ï¼ˆç»ç’ƒï¼‰
                </h3>

                <div className="mb-4">
                  <label className="text-xs text-gray-600 block mb-1">æ ç›®æ•°é‡: {config.categoryCount}</label>
                  <input
                    type="range"
                    min="2"
                    max="8"
                    step="1"
                    value={config.categoryCount}
                    onChange={e => setCategoryCount(parseInt(e.target.value, 10))}
                    className="w-full"
                  />
                </div>

                <div className="mb-4">
                  <label className="text-xs text-gray-600 block mb-1">åˆ†ç±»å±‚æ ·å¼</label>
                  <select
                    value={config.categoryStyle}
                    onChange={e => setConfig(prev => ({ ...prev, categoryStyle: e.target.value }))}
                    className="w-full p-2 border rounded bg-white text-sm"
                  >
                    <option value="liquidPro">Liquid Glass Proï¼ˆæŠ˜å°„ + é•œé¢é«˜å…‰ï¼‰</option>
                    <option value="liquid">Liquid Glassï¼ˆæŠ˜å°„ + ç£¨ç ‚ï¼‰</option>
                    <option value="glass">Frosted Glassï¼ˆçº¯ç£¨ç ‚ç»ç’ƒï¼‰</option>
                    <option value="classic">Classicï¼ˆå¯¹ç…§ï¼‰</option>
                  </select>
                </div>

                <div className="space-y-2 mb-2 max-h-56 overflow-y-auto pr-1">
                  {Array.from({ length: config.categoryCount }).map((_, i) => (
                    <div key={i} className="flex gap-2">
                      <input
                        type="text"
                        value={config.categories[i] || ""}
                        onChange={(e) => updateCategoryName(i, e.target.value)}
                        className="flex-1 text-sm p-2 border rounded"
                        placeholder={`åˆ†ç±» ${i + 1} åç§°`}
                      />
                      <select
                        value={config.categoryWidthDivs?.[i] ?? clamp(config.categoryCount, 1, 8)}
                        onChange={e => updateCategoryWidth(i, e.target.value)}
                        className="w-28 p-2 border rounded bg-white text-sm"
                        title="è¯¥åˆ†ç±»æ¡†å å±å®½æ¯”ä¾‹"
                      >
                        {widthOptions.map(d => (
                          <option key={d} value={d}>{fmtFrac(d)}</option>
                        ))}
                      </select>
                    </div>
                  ))}
                </div>

                {/* ç»ç’ƒè°ƒå‚ï¼ˆé»˜è®¤å±•å¼€ï¼‰ */}
                <details className="mt-4" open>
                  <summary className="cursor-pointer text-xs text-gray-600 select-none">é«˜çº§è°ƒå‚ï¼ˆé»˜è®¤å·²å±•å¼€ï¼‰</summary>
                  <div className="mt-3 space-y-3">
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <label className="text-xs text-gray-600 block mb-1">åˆ†ç±»æ ‡ç­¾å­—é‡</label>
                        <input
                          type="number"
                          min="100"
                          max="900"
                          step="50"
                          value={config.labelFontWeight}
                          onChange={e => setConfig(prev => ({ ...prev, labelFontWeight: clamp(parseInt(e.target.value || "500", 10), 100, 900) }))}
                          className="w-full p-2 border rounded text-sm font-mono"
                        />
                        <p className="text-[11px] text-gray-500 mt-1">æ¯æ­¥ 50ï¼šä¾‹å¦‚ 350/400/450/500â€¦</p>
                      </div>
                      <div>
                        <label className="text-xs text-gray-600 block mb-1">æŠ˜å°„ç§å­ï¼ˆseedï¼‰</label>
                        <input
                          type="number"
                          min="0"
                          max="9999"
                          value={config.liquidSeed}
                          onChange={e => setConfig(prev => ({ ...prev, liquidSeed: parseInt(e.target.value || "0", 10) }))}
                          className="w-full p-2 border rounded text-sm font-mono"
                        />
                        <p className="text-[11px] text-gray-500 mt-1">æ¢ä¸€ä¸ª seedï¼ŒæŠ˜å°„çº¹ç†ä¼šå˜</p>
                      </div>
                    </div>

                    <div>
                      <label className="text-xs text-gray-600 block mb-1">ç£¨ç ‚æ¨¡ç³Š: {config.glassBlur}</label>
                      <input type="range" min="0" max="26" step="1" value={config.glassBlur}
                        onChange={e => setConfig(prev => ({ ...prev, glassBlur: parseInt(e.target.value, 10) }))}
                        className="w-full"
                      />
                    </div>

                    <div>
                      <label className="text-xs text-gray-600 block mb-1">ç™½è‰²æŸ“è‰²: {Math.round(config.glassTintOpacity * 100)}%</label>
                      <input type="range" min="0" max="0.55" step="0.01" value={config.glassTintOpacity}
                        onChange={e => setConfig(prev => ({ ...prev, glassTintOpacity: parseFloat(e.target.value) }))}
                        className="w-full"
                      />
                    </div>

                    <div>
                      <label className="text-xs text-gray-600 block mb-1">é«˜å…‰å¼ºåº¦: {Math.round(config.glassHighlightOpacity * 100)}%</label>
                      <input type="range" min="0" max="1" step="0.02" value={config.glassHighlightOpacity}
                        onChange={e => setConfig(prev => ({ ...prev, glassHighlightOpacity: parseFloat(e.target.value) }))}
                        className="w-full"
                      />
                    </div>

                    <div>
                      <label className="text-xs text-gray-600 block mb-1">è¾¹ç¼˜é€æ˜åº¦: {Math.round(config.glassStrokeOpacity * 100)}%</label>
                      <input type="range" min="0" max="1" step="0.02" value={config.glassStrokeOpacity}
                        onChange={e => setConfig(prev => ({ ...prev, glassStrokeOpacity: parseFloat(e.target.value) }))}
                        className="w-full"
                      />
                    </div>

                    <div className="pt-2 border-t border-gray-200">
                      <label className="text-xs text-gray-600 block mb-1">æ¶²æ€æŠ˜å°„å¼ºåº¦ï¼ˆscaleï¼‰: {config.liquidScale}</label>
                      <input type="range" min="0" max="150" step="1" value={config.liquidScale}
                        onChange={e => setConfig(prev => ({ ...prev, liquidScale: parseInt(e.target.value, 10) }))}
                        className="w-full"
                      />
                      <p className="text-[11px] text-gray-500 mt-1">å¤ªæ™ƒå°±å¾€ 12~25 é™ï¼›æƒ³æ›´æ˜æ˜¾å°±åŠ å¤§ã€‚</p>
                    </div>

                    <div>
                      <label className="text-xs text-gray-600 block mb-1">æŠ˜å°„çº¹ç†é¢‘ç‡: {config.liquidFrequency}</label>
                      <input type="range" min="0.005" max="0.03" step="0.001" value={config.liquidFrequency}
                        onChange={e => setConfig(prev => ({ ...prev, liquidFrequency: parseFloat(e.target.value) }))}
                        className="w-full"
                      />
                    </div>

                    <div className="pt-2 border-t border-gray-200">
                      <label className="text-xs text-gray-600 block mb-1">é•œé¢é«˜å…‰ï¼ˆProï¼‰: {Math.round(config.specularOpacity * 100)}%</label>
                      <input type="range" min="0" max="0.35" step="0.01" value={config.specularOpacity}
                        onChange={e => setConfig(prev => ({ ...prev, specularOpacity: parseFloat(e.target.value) }))}
                        className="w-full"
                      />
                    </div>
                  </div>
                </details>
              </div>

              {/* 4. åº•éƒ¨å°è´´å£« */}
              <div className="bg-gray-50 p-4 rounded-lg border border-gray-100">
                <h3 className="font-semibold text-gray-700 mb-3 flex items-center">
                  <span className="w-6 h-6 rounded-full bg-yellow-100 text-yellow-600 flex items-center justify-center mr-2 text-xs">4</span>
                  åº•éƒ¨å°è´´å£«ï¼ˆç»ç’ƒï¼Œå¯ç‹¬ç«‹è°ƒå‚ï¼‰
                </h3>

                <div className="mb-4">
                  <label className="text-xs text-gray-600 block mb-1">æ ç›®æ•°é‡: {config.bottomCount}</label>
                  <input
                    type="range"
                    min="1"
                    max="8"
                    step="1"
                    value={config.bottomCount}
                    onChange={e => setBottomCount(parseInt(e.target.value, 10))}
                    className="w-full"
                  />
                </div>

                <div className="mb-4">
                  <label className="text-xs text-gray-600 block mb-1">å°è´´å£«æ ·å¼</label>
                  <select
                    value={config.tipsStyle}
                    onChange={e => setConfig(prev => ({ ...prev, tipsStyle: e.target.value }))}
                    className="w-full p-2 border rounded bg-white text-sm"
                  >
                    <option value="liquidPro">Liquid Glass Pro</option>
                    <option value="liquid">Liquid Glass</option>
                    <option value="glass">Frosted Glass</option>
                    <option value="classic">Classicï¼ˆå¯¹ç…§ï¼‰</option>
                  </select>
                </div>

                <div className="space-y-4 max-h-72 overflow-y-auto pr-1">
                  {Array.from({ length: config.bottomCount }).map((_, i) => (
                    <div key={i} className="border-b pb-3 last:border-0">
                      <div className="flex items-center justify-between gap-2 mb-2">
                        <div className="text-xs text-gray-500">å°è´´å£« {i + 1}</div>
                        <select
                          value={config.bottomWidthDivs?.[i] ?? clamp(config.bottomCount, 1, 8)}
                          onChange={e => updateBottomWidth(i, e.target.value)}
                          className="w-28 p-2 border rounded bg-white text-sm"
                          title="è¯¥å°è´´å£«æ¡†å å±å®½æ¯”ä¾‹"
                        >
                          {widthOptions.map(d => (
                            <option key={d} value={d}>{fmtFrac(d)}</option>
                          ))}
                        </select>
                      </div>
                      <textarea
                        rows="3"
                        value={config.bottomContents[i] || ""}
                        onChange={e => updateBottomContent(i, e.target.value)}
                        className="w-full p-2 text-sm border rounded resize-none"
                        placeholder="ç¬¬ä¸€è¡Œå°†ä½œä¸ºæ ‡é¢˜..."
                      />
                    </div>
                  ))}
                </div>

                {/* å°è´´å£«ç»ç’ƒè°ƒå‚ï¼ˆé»˜è®¤å±•å¼€ï¼‰ */}
                <details className="mt-4" open>
                  <summary className="cursor-pointer text-xs text-gray-600 select-none">å°è´´å£«é«˜çº§è°ƒå‚ï¼ˆé»˜è®¤å·²å±•å¼€ï¼‰</summary>
                  <div className="mt-3 space-y-3">
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <label className="text-xs text-gray-600 block mb-1">Tint é¢œè‰²</label>
                        <div className="flex gap-2 items-center">
                          <input
                            type="color"
                            value={config.tipsTintColor}
                            onChange={e => setConfig(prev => ({ ...prev, tipsTintColor: e.target.value }))}
                            className="h-8 w-16 cursor-pointer"
                          />
                          <input
                            type="text"
                            value={config.tipsTintColor}
                            onChange={e => setConfig(prev => ({ ...prev, tipsTintColor: e.target.value }))}
                            className="flex-1 p-2 border rounded text-xs font-mono"
                            placeholder="#000000"
                          />
                        </div>
                      </div>
                      <div>
                        <label className="text-xs text-gray-600 block mb-1">æŠ˜å°„ç§å­ï¼ˆseedï¼‰</label>
                        <input
                          type="number"
                          min="0"
                          max="9999"
                          value={config.tipsLiquidSeed}
                          onChange={e => setConfig(prev => ({ ...prev, tipsLiquidSeed: parseInt(e.target.value || "0", 10) }))}
                          className="w-full p-2 border rounded text-sm font-mono"
                        />
                      </div>
                    </div>

                    <div>
                      <label className="text-xs text-gray-600 block mb-1">ç£¨ç ‚æ¨¡ç³Š: {config.tipsBlur}</label>
                      <input type="range" min="0" max="26" step="1" value={config.tipsBlur}
                        onChange={e => setConfig(prev => ({ ...prev, tipsBlur: parseInt(e.target.value, 10) }))}
                        className="w-full"
                      />
                    </div>

                    <div>
                      <label className="text-xs text-gray-600 block mb-1">Tint é€æ˜åº¦: {Math.round(config.tipsTintOpacity * 100)}%</label>
                      <input type="range" min="0" max="0.65" step="0.01" value={config.tipsTintOpacity}
                        onChange={e => setConfig(prev => ({ ...prev, tipsTintOpacity: parseFloat(e.target.value) }))}
                        className="w-full"
                      />
                    </div>

                    <div>
                      <label className="text-xs text-gray-600 block mb-1">é«˜å…‰å¼ºåº¦: {Math.round(config.tipsHighlightOpacity * 100)}%</label>
                      <input type="range" min="0" max="1" step="0.02" value={config.tipsHighlightOpacity}
                        onChange={e => setConfig(prev => ({ ...prev, tipsHighlightOpacity: parseFloat(e.target.value) }))}
                        className="w-full"
                      />
                    </div>

                    <div>
                      <label className="text-xs text-gray-600 block mb-1">è¾¹ç¼˜é€æ˜åº¦: {Math.round(config.tipsStrokeOpacity * 100)}%</label>
                      <input type="range" min="0" max="1" step="0.02" value={config.tipsStrokeOpacity}
                        onChange={e => setConfig(prev => ({ ...prev, tipsStrokeOpacity: parseFloat(e.target.value) }))}
                        className="w-full"
                      />
                    </div>

                    <div className="pt-2 border-t border-gray-200">
                      <label className="text-xs text-gray-600 block mb-1">æ¶²æ€æŠ˜å°„å¼ºåº¦ï¼ˆscaleï¼‰: {config.tipsLiquidScale}</label>
                      <input type="range" min="0" max="150" step="1" value={config.tipsLiquidScale}
                        onChange={e => setConfig(prev => ({ ...prev, tipsLiquidScale: parseInt(e.target.value, 10) }))}
                        className="w-full"
                      />
                      <p className="text-[11px] text-gray-500 mt-1">åº•éƒ¨å»ºè®®æ›´å…‹åˆ¶ï¼š10~45 æ›´è€çœ‹ã€‚</p>
                    </div>

                    <div>
                      <label className="text-xs text-gray-600 block mb-1">æŠ˜å°„çº¹ç†é¢‘ç‡: {config.tipsLiquidFrequency}</label>
                      <input type="range" min="0.005" max="0.03" step="0.001" value={config.tipsLiquidFrequency}
                        onChange={e => setConfig(prev => ({ ...prev, tipsLiquidFrequency: parseFloat(e.target.value) }))}
                        className="w-full"
                      />
                    </div>

                    <div className="pt-2 border-t border-gray-200">
                      <label className="text-xs text-gray-600 block mb-1">é•œé¢é«˜å…‰ï¼ˆProï¼‰: {Math.round(config.tipsSpecularOpacity * 100)}%</label>
                      <input type="range" min="0" max="0.35" step="0.01" value={config.tipsSpecularOpacity}
                        onChange={e => setConfig(prev => ({ ...prev, tipsSpecularOpacity: parseFloat(e.target.value) }))}
                        className="w-full"
                      />
                    </div>
                  </div>
                </details>
              </div>

              {/* ä¸‹è½½æŒ‰é’® */}
              <div className="flex gap-2 pt-2 pb-10">
                <button
                  onClick={downloadPNG}
                  className="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-bold shadow transition"
                >
                  ä¸‹è½½ PNG
                </button>
                <button
                  onClick={downloadSVG}
                  className="px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition"
                  title="ä¸‹è½½çŸ¢é‡æºæ–‡ä»¶"
                >
                  SVG
                </button>
              </div>
            </div>
          </div>

          {/* å³ä¾§é¢„è§ˆåŒºåŸŸ */}
          <div className="flex-1 bg-gray-200 overflow-auto flex flex-col items-center relative preview-container">
            {/* é¡¶éƒ¨æ‚¬æµ®æ¡ï¼šå±…ä¸­ç¼©æ”¾ + å³ä¸Šè§’å…¨å±ï¼ˆä¸æ”¾ä¾§è¾¹æ ï¼‰ */}
            <div className="sticky top-4 z-30 w-full px-4 mb-4">
              <div className="grid grid-cols-[1fr_auto_1fr] items-center">
                <div />

                <div className="bg-white/90 backdrop-blur px-4 py-2 rounded-full shadow-md flex gap-4 items-center justify-center">
                  <span className="text-xs font-bold text-gray-500">é¢„è§ˆç¼©æ”¾</span>
                  <input
                    type="range"
                    min="0.1"
                    max="1"
                    step="0.05"
                    value={zoom}
                    onChange={(e) => setZoom(parseFloat(e.target.value))}
                    className="w-32 cursor-pointer"
                  />
                  <span className="text-xs font-mono text-gray-500 w-10">{Math.round(zoom * 100)}%</span>
                </div>

                <div className="flex justify-end">
                  <button
                    onClick={openFullPreview}
                    className="bg-white/90 backdrop-blur px-3 py-2 rounded-lg shadow-md text-sm font-medium text-gray-700 hover:bg-white"
                    title="å…¨å±é¢„è§ˆï¼ˆEsc é€€å‡ºï¼‰"
                  >
                    å…¨å±é¢„è§ˆ
                  </button>
                </div>
              </div>
            </div>

            <div
              style={{
                width: config.width * zoom,
                height: config.height * zoom,
                boxShadow: "0 20px 50px rgba(0,0,0,0.2)",
                marginBottom: "50px"
              }}
              className="bg-white shrink-0 transition-all duration-200"
            >
              <WallpaperSVG attachRef />
            </div>

            <div className="pb-12 text-xs text-gray-600">
              æç¤ºï¼šè‹¥ä½ æŠŠå¤šä¸ªæ¡†çš„â€œå®½åº¦åˆ†æ•°â€åŠ èµ·æ¥è¶…è¿‡ 1ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŒ‰æ¯”ä¾‹æ•´ä½“ç¼©å°ï¼Œè®©å®ƒä»¬ä»èƒ½è£…è¿›ä¸€è¡Œã€‚
            </div>
          </div>
        </div>

        {/* å…¨å±é¢„è§ˆå±‚ */}
        {fullPreview && (
          <div
            className="fixed inset-0 z-50 bg-black/85"
            onClick={closeFullPreview}
          >
            <div className="absolute top-4 right-4 z-50 flex gap-2">
              <button
                onClick={(e) => { e.stopPropagation(); closeFullPreview(); }}
                className="bg-white/90 backdrop-blur px-3 py-2 rounded-lg shadow-md text-sm font-medium text-gray-800 hover:bg-white"
                title="é€€å‡ºï¼ˆEscï¼‰"
              >
                é€€å‡ºé¢„è§ˆ
              </button>
            </div>

            <div
              className="w-full h-full flex items-center justify-center p-4"
              onClick={(e) => e.stopPropagation()}
            >
              <div className="w-[95vw] h-[95vh] bg-black/10 rounded-xl shadow-2xl overflow-hidden">
                {fullPreviewUrl ? (
                  <img
                    src={fullPreviewUrl}
                    alt="wallpaper preview"
                    className="w-full h-full object-contain"
                    draggable={false}
                  />
                ) : null}
              </div>
            </div>
          </div>
        )}

        </>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
